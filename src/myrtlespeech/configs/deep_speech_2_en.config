speech_to_text {
  alphabet: " abcdefghijklmnopqrstuvwxyz'_";

  pre_process_step {
    stage: TRAIN_AND_EVAL;
    mfcc {
      n_mfcc: 80;
      win_length: 400;
      hop_length: 160;
    }
  }

  pre_process_step {
    stage: TRAIN_AND_EVAL;
    standardize {
    }
  }

  deep_speech_2 {
    conv_layer {
      output_channels: 32;
      kernel_dim: 41;
      kernel_dim: 11;
      stride: 2;
      stride: 2;
      bias: true;
    }

    conv_layer {
      output_channels: 32;
      kernel_dim: 21;
      kernel_dim: 11;
      stride: 2;
      stride: 1;
      bias: true;
    }

    rnn {
      rnn_type: LSTM;
      hidden_size: 1024;
      num_layers: 2;
      bias: true;
      bidirectional: true;
      forget_gate_bias {
        value: 1.0;
      }
    }

    fully_connected {
      num_hidden_layers: 1;
      hidden_size: 1024;
      hidden_activation_fn: RELU;
    }
  }

  ctc_loss {
    blank_index: 28;
    reduction: SUM;
  }

  ctc_greedy_decoder {
	blank_index: 28;
  }
}

train_config {
  batch_size: 96;
  epochs: 1000;
  adam {
    learning_rate: 0.001;
  }
  dataset {
    librispeech {
      root: "/data/";
      subset: TRAIN_CLEAN_100;
      subset: TRAIN_CLEAN_360;
      subset: TRAIN_OTHER_500;
      max_secs {
        value: 16.7;
      }
    }
  }
  shuffle_batches_before_every_epoch: true;
}

eval_config {
  batch_size: 96;
  dataset {
    librispeech {
      root: "/data/";
      subset: DEV_CLEAN;
    }
  }
}
